# 18 Анализ Uniswap на нескольких цепочках

Uniswap является одной из ведущих децентрализованных бирж (DEX) в DeFi-пространстве. Умный контракт Uniswap был изначально развернут в блокчейне Ethereum в 2018 году. С тех пор он распространился на другие цепочки, такие как Arbitrum, Optimism, Polygon и Celo в 2021 и 2022 годах. Он продолжает набирать обороты с новым предложением о развертывании на Binance Smart Chain (BNB). В этой статье мы рассмотрим, как анализировать производительность Uniswap на нескольких цепочках в 2022 году. Обратите внимание, что цепочка Celo не включена в этот анализ, поскольку она в настоящее время не поддерживается Dune.

Панель мониторинга для этого учебного пособия: [Производительность Uniswap V3 в 2022 на нескольких цепочках](https://dune.com/sixdegree/uniswap-v3-performance-in-2022-multi-chains)<a id="jump_8"></a>

Все запросы в этом учебном пособии выполняются с помощью Dune SQL.

Интересно, что во время завершения этого учебного пособия Uniswap Foundation запустила новый раунд программы вознаграждений, посвященной анализу производительности Uniswap на нескольких цепочках 25 января 2023 года. Этот учебник надеется предоставить некоторые идеи и представления; участники могут дополнительно расширить эти запросы для участия в программе вознаграждений. Желаем вам удачи в получении щедрых наград. Вы можете найти больше информации о программе Unigrants и [Вознаграждение #21 - Uniswap на нескольких цепочках](https://unigrants.notion.site/Bounty-21-Uniswap-Multichain-b1edc714fe1949779530e920701fd617)<a id="jump_8"></a> здесь.

## Ключевое содержание анализа данных на нескольких цепочках

Как указано в описании активности "Вознаграждение #21 - Uniswap на нескольких цепочках", при анализе DeFi-приложений, таких как Uniswap, наиболее распространенные метрики, которые нам необходимо анализировать, включают объем торгов, стоимость торгов, пользовательскую базу и Общий объем заблокированных средств (TVL). Uniswap развертывает смарт-контракты для многочисленных пулов ликвидности, которые облегчают торговые пары различных токенов. Поставщики ликвидности (LP) вносят средства в эти пулы, чтобы получать вознаграждения за комиссии за транзакции, а другие пользователи могут обменивать свои токены, используя эти пулы ликвидности. Следовательно, более углубленный анализ также может включать метрики, связанные с пулом ликвидности и LP.

В этом учебном пособии мы сосредоточимся в первую очередь на следующих темах:

* Обзор общей торговой активности (количество сделок, объем торгов, количество пользователей, TVL)
* Ежедневное сравнение данных о торговле
* Ежедневное сравнение новых пользователей
* Годовое сравнение создаваемых новых пулов ликвидности
* Ежедневное сравнение новых пулов ликвидности
* Сравнение TVL
* Ежедневный TVL
* Пулы ликвидности с самым высоким TVL

Сообщество Dune создало всесторонний набор данных о торговле под названием "uniswap.trades", который агрегирует данные о транзакциях из смарт-контрактов, связанных с Uniswap, на упомянутых четырех блокчейнах. Большинство наших запросов могут напрямую использовать эту таблицу. Однако в настоящее время нет набора данных о пулах ликвидности, поэтому нам потребуется писать запросы для агрегирования данных из разных блокчейнов для сравнительного анализа.

Важно отметить, что в этом учебном пособии мы в первую очередь фокусируемся на данных за 2022 год. Поэтому в связанных запросах есть условия фильтрации по дате. Если вы хотите проанализировать все исторические данные, просто удалите эти условия.

## Обзор общей торговой активности

Мы можем написать запрос непосредственно к "uniswap.trades" для суммирования общего объема торгов, количества сделок и количества уникальных адресов пользователей.

```sql
select blockchain,
    sum(amount_usd) as trade_amount,
    count(*) as transaction_count,
    count(distinct taker) as user_count
from uniswap.trades
where block_time >= date('2022-01-01')
    and block_time < date('2023-01-01')
group by 1
```

Учитывая, что результирующие данные могут быть довольно большими, мы можем поместить вышеуказанный запрос в CTE (Common Table Expression). При выводе данных из CTE мы можем преобразовать числа в миллионы или миллиарды единиц и удобно агрегировать данные из нескольких цепочек вместе.

Мы добавим 3 графики-счетчика для общего объема торгов, количества сделок и количества пользователей. Кроме того, мы добавим 3 круговых графика для отображения процента объема торгов, количества сделок и количества пользователей для каждой цепочки.  Кроме того, мы включим табличный график для представления подробных чисел. Все эти графики будут добавлены на панель управления, что приведет к следующему отображению:

![](img/ch18_image_01.png)

Ссылка на запрос:
* [https://dune.com/queries/1859214](https://dune.com/queries/1859214)<a id="jump_8"></a>

## Сравнительный анализ ежедневных транзакций

Аналогично, используя таблицу `uniswap.trades magical`, мы можем написать SQL-запрос для расчета ежедневных данных о транзакциях. SQL-запрос выглядит следующим образом:

``` sql
with transaction_summary as (
    select date_trunc('day', block_time) as block_date,
        blockchain,
        sum(amount_usd) as trade_amount,
        count(*) as transaction_count,
        count(distinct taker) as user_count
    from uniswap.trades
    where block_time >= date('2022-01-01')
        and block_time < date('2023-01-01')
    group by 1, 2
)

select block_date,
    blockchain,
    trade_amount,
    transaction_count,
    user_count,
    sum(trade_amount) over (partition by blockchain order by block_date) as accumulate_trade_amount,
    sum(transaction_count) over (partition by blockchain order by block_date) as accumulate_transaction_count,
    sum(user_count) over (partition by blockchain order by block_date) as accumulate_user_count
from transaction_summary
order by 1, 2
```

Здесь мы суммируем все данные о транзакциях за 2022 год на основе даты и блокчейнов. Мы также выводим кумулятивные данные на основе даты. Важно отметить, что кумулятивный подсчет пользователей в этой агрегации не является точным представлением "кумулятивного уникального числа пользователей", поскольку один и тот же пользователь может совершать транзакции в разные даты. Мы объясним, как рассчитать уникальное число пользователей, в последующих запросах.

Поскольку наша цель состоит в том, чтобы анализировать производительность данных на разных цепочках, мы можем сосредоточиться как на конкретных значениях, так и на их пропорциях. Пропорциональный анализ позволяет визуально наблюдать за тенденциями различных цепочек с течением времени. При этом мы генерируем следующие графики: Линейный график для ежедневного объема транзакций, Столбчатая диаграмма для количества ежедневных транзакций/ежедневного уникального числа пользователей, График площади для кумулятивного объема транзакций, а также количества транзакций/уникального числа пользователей и еще один график площади для отображения процентного вклада каждого ежедневного объема транзакций. Получившиеся графики при добавлении на панель управления будут выглядеть следующим образом:

![](img/ch18_image_02.png)

Ссылка на запрос:
* [https://dune.com/queries/1928680](https://dune.com/queries/1928680)<a id="jump_8"></a>
